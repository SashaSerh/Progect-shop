export const translations = {
    ru: {
        "site-title": "ClimaTech",
        "header-title": "ClimaTech",
        "nav-home": "Главная",
        "nav-services": "Услуги",
        "nav-products": "Товары",
        "nav-contacts": "Контакты",
        "hero-title": "Комфортный климат в вашем доме",
        "hero-subtitle": "Профессиональный монтаж и продажа кондиционеров и рекуператоров.",
        "hero-cta": "Посмотреть товары",
        "services-title": "Наши услуги",
        "service-ac-install-title": "Монтаж кондиционеров",
        "service-ac-install-desc": "Профессиональная установка любой сложности.",
        "service-recuperator-install-title": "Монтаж рекуператоров",
        "service-recuperator-install-desc": "Вентиляционные системы для свежего воздуха.",
        "service-maintenance-title": "Обслуживание систем",
        "service-maintenance-desc": "Чистка и ремонт климатического оборудования.",
        "service-order": "Заказать",
        "products-title": "Наши товары",
        "filter-category": "Категория:",
        "filter-price": "Цена:",
        "filter-all": "Все",
        "filter-ac": "Кондиционеры",
        "filter-recuperator": "Рекуператоры",
        "filter-low-to-high": "От низкой к высокой",
        "filter-high-to-low": "От высокой к низкой",
        "contacts-title": "Свяжитесь с нами",
    "contacts-email": "Email: climatechprovent@gmail.com",
        "contacts-phone": "Телефон: +380-800-555-1234",
        "contacts-address": "Адрес: ул. Климатическая, 123, Киев",
        "form-name": "Ваше имя",
        "form-email": "Ваш email",
        "form-message": "Ваше сообщение",
        "form-submit": "Отправить сообщение",
    "footer-title": "ClimaTech",
    "footer-copyright": "© 2025 ClimaTech. Все права защищены.",
        "cart-items": "0 товаров",
        "cart-total": "Итого: $0.00",
        "cart-clear": "Очистить корзину",
        "cart-checkout": "Оформить заказ",
        "cart-modal-title": "Ваша корзина",
        "login": "Войти",
        "login-title": "Вход",
        "username": "Имя пользователя",
        "password": "Пароль",
        "profile": "Личный кабинет",
        "profile-title": "Личный кабинет",
        "welcome": "Добро пожаловать",
        "logout": "Выйти",
        "cart-empty": "Корзина пуста",
        "nav-about": "О нас",
        "about-title": "О нас",
        "about-desc": "Мы - команда экспертов по климат-контролю с 10+ лет опыта.",
        "orders-title": "Мои заказы",
        "catalog": "Каталог",
        "search-placeholder": "Поиск по сайту",
        "portfolio-title": "Наши работы",
    "portfolio-item-1-title": "Монтаж сплит-системы в квартире",
    "portfolio-item-1-description": "Установили инверторную сплит-систему с трассой 7м и скрытой прокладкой. Срок — 1 день.",
    "portfolio-item-2-title": "Вентиляция в частном доме",
    "portfolio-item-2-description": "Проектирование и монтаж приточно-вытяжной системы с рекуперацией тепла. Срок — 3 дня.",
    "portfolio-item-3-title": "Сезонное обслуживание",
    "portfolio-item-3-description": "Очистка теплообменника, проверка хладагента, диагностика узлов. Гарантия — 6 месяцев.",
        "form-sending": "Отправляем...",
        "form-success": "Спасибо! Мы свяжемся с вами.",
        "form-error": "Ошибка отправки. Попробуйте позже."
        ,
        "form-error-name": "Введите имя",
        "form-error-email": "Укажите email",
        "form-error-email-format": "Некорректный email",
        "form-error-message": "Введите сообщение"
        ,
    "toast-item-removed": "Товар удалён",
    "toast-undo": "Отменить",
        "in-stock": "В наличии",
        "on-order": "Под заказ",
        "warranty": "Гарантия",
        "brand": "Бренд",
        "sku": "Артикул",
        "add-to-cart": "Добавить в корзину",
        "specs": "Характеристики",
        "show-more-specs": "Показать все характеристики",
        "hide-specs": "Скрыть характеристики",
        "spec-power": "Мощность",
        "spec-area": "Площадь",
        "spec-noise": "Уровень шума",
        "spec-energy": "Энергоэффективность",
        "spec-dimensions": "Габариты"
        ,
        "details": "Подробнее"
        ,
        "welcome-greeting": "Добро пожаловать на ClimaTech",
        "welcome-choose-language": "Выберите язык интерфейса",
        "welcome-current-language": "Текущий язык",
        "welcome-continue": "Продолжить"
    },
    uk: {
        "site-title": "ClimaTech",
        "header-title": "ClimaTech",
        "site-title": "ClimaTech",
        "header-title": "ClimaTech",
        "footer-title": "ClimaTech",
        // Добавлены недостающие ключи навигации для украинского
        "nav-home": "Головна",
        "nav-services": "Послуги",
        "nav-products": "Товари",
        "nav-contacts": "Контакти",
        "services-title": "Наші послуги",
        "hero-title": "Комфортний клімат у вашому домі",
        "hero-subtitle": "Професійний монтаж та продаж кондиціонерів і рекуператорів.",
        "hero-cta": "Переглянути товари",
        "site-title": "ClimaTech",
        "header-title": "ClimaTech",
        "footer-title": "ClimaTech",
        "service-ac-install-title": "Монтаж кондиціонерів",
        "service-ac-install-desc": "Професійна установка будь-якої складності.",
        "service-recuperator-install-title": "Монтаж рекуператорів",
        "service-recuperator-install-desc": "Вентиляційні системи для свіжого повітря.",
        "service-maintenance-title": "Обслуговування систем",
        "service-maintenance-desc": "Чищення та ремонт кліматичного обладнання.",
        "service-order": "Замовити",
        "products-title": "Наші товари",
        "filter-category": "Категорія:",
        "filter-price": "Ціна:",
        "filter-all": "Усі",
        "filter-ac": "Кондиціонери",
        "filter-recuperator": "Рекуператори",
        "filter-low-to-high": "Від низької до високої",
        "filter-high-to-low": "Від високої до низкої",
        "contacts-title": "Зв’яжіться з нами",
    "contacts-email": "Email: climatechprovent@gmail.com",
        "contacts-phone": "Телефон: +380-800-555-1234",
    "contacts-address": "Адреса: вул. Кліматична, 123, Київ",
        "form-name": "Ваше ім’я",
        "form-email": "Ваш email",
        "form-message": "Ваше повідомлення",
        "form-submit": "Надіслати повідомлення",
    "footer-title": "ClimaTech",
    "footer-copyright": "© 2025 ClimaTech. Усі права захищені.",
        "cart-items": "0 товарів",
        "cart-total": "Разом: $0.00",
        "cart-clear": "Очистити кошик",
        "cart-checkout": "Оформити замовлення",
        "cart-modal-title": "Ваш кошик",
        "login": "Увійти",
        "login-title": "Вхід",
        "username": "Ім'я користувача",
        "password": "Пароль",
        "profile": "Особистий кабінет",
        "profile-title": "Особистий кабінет",
        "welcome": "Вітаємо",
        "logout": "Вийти",
        "cart-empty": "Кошик порожній",
        "nav-about": "Про нас",
        "about-title": "Про нас",
        "about-desc": "Ми - команда експертів з клімат-контролю з 10+ років досвіду.",
        "orders-title": "Мої замовлення",
        "catalog": "Каталог",
        "search-placeholder": "Пошук по сайту",
        "portfolio-title": "Наші роботи",
    "portfolio-item-1-title": "Монтаж спліт-системи в квартирі",
    "portfolio-item-1-description": "Встановили інверторну спліт-систему з трасою 7 м і прихованою прокладкою. Термін — 1 день.",
    "portfolio-item-2-title": "Вентиляція в приватному будинку",
    "portfolio-item-2-description": "Проєктування та монтаж припливно-витяжної системи з рекуперацією тепла. Термін — 3 дні.",
    "portfolio-item-3-title": "Сезонне обслуговування",
    "portfolio-item-3-description": "Очищення теплообмінника, перевірка холодоагенту, діагностика вузлів. Гарантія — 6 місяців.",
        "form-sending": "Відправляємо...",
        "form-success": "Дякуємо! Ми зв'яжемося з вами.",
        "form-error": "Помилка відправки. Спробуйте пізніше.",
        "form-error-name": "Введіть ім'я",
        "form-error-email": "Вкажіть email",
        "form-error-email-format": "Некоректний email",
        "form-error-message": "Введіть повідомлення"
        ,
        "toast-item-removed": "Товар видалено",
        "toast-undo": "Скасувати",
        "in-stock": "В наявності",
        "on-order": "Під замовлення",
        "warranty": "Гарантія",
        "brand": "Бренд",
        "sku": "Артикул",
        "add-to-cart": "Додати до кошика",
        "specs": "Характеристики",
        "show-more-specs": "Показати всі характеристики",
        "hide-specs": "Сховати характеристики",
        "spec-power": "Потужність",
        "spec-area": "Площа",
        "spec-noise": "Рівень шуму",
        "spec-energy": "Енергоефективність",
        "spec-dimensions": "Габарити"
        ,
        "details": "Докладніше"
        ,
        "welcome-greeting": "Ласкаво просимо до ClimaTech",
        "welcome-choose-language": "Оберіть мову інтерфейсу",
        "welcome-current-language": "Поточна мова",
        "welcome-continue": "Продовжити"
    }
};

export function switchLanguage(lang) {
    // Безопасный язык + fallback на ru
    const safeLang = ['ru','uk'].includes(lang) ? lang : 'ru';
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const value = translations[safeLang][key] || translations.ru[key];
        if (value) element.textContent = value;
    });

    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        const value = translations[safeLang][key] || translations.ru[key];
        if (value) element.placeholder = value;
    });

    document.querySelectorAll('option[data-i18n]').forEach(option => {
        const key = option.getAttribute('data-i18n');
        const value = translations[safeLang][key] || translations.ru[key];
        if (value) option.textContent = value;
    });

    document.title = translations[safeLang]['site-title'] || 'ClimaTech';
    localStorage.setItem('language', safeLang);

    // Отправляем кастомное событие для синхронизации UI
    try {
        const event = new CustomEvent('languagechange', { detail: { lang: safeLang } });
        window.dispatchEvent(event);
    } catch (err) {
        console.warn('Не удалось отправить событие languagechange', err);
    }
}

// Экспорт в глобальную область для совместимости
window.switchLanguage = switchLanguage;
// Экспортируем словари в window для использования в других модулях
window.translations = translations;

// Унифицированная инициализация всех переключателей языка (десктоп + мобильные чипы)
export function initLanguageSwitchers() {
    const current = localStorage.getItem('language') || 'ru';
    const desktopButtons = document.querySelectorAll('.language-switcher');
    const chips = document.querySelectorAll('.mobile-settings__lang .lang-chip');

    function updateStates(activeLang) {
        desktopButtons.forEach(btn => {
            const isActive = btn.dataset.lang === activeLang;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-pressed', isActive);
        });
        chips.forEach(chip => {
            const isActive = chip.getAttribute('data-lang') === activeLang;
            chip.classList.toggle('active', isActive);
            chip.setAttribute('aria-pressed', isActive);
        });
    }

    updateStates(current);

    function attach(el, getLang) {
        el.addEventListener('click', (e) => {
            e.stopPropagation();
            const lang = getLang(el);
            if (!['ru','uk'].includes(lang)) return;
            switchLanguage(lang);
            updateStates(lang);
            // Дополнительные обновления, если глобальные функции доступны
            if (window.translations) {
                if (typeof renderProducts === 'function') {
                    renderProducts(lang, window.translations);
                }
                if (typeof updateCartUI === 'function') {
                    updateCartUI(window.translations, lang);
                }
                if (typeof updateProfileButton === 'function') {
                    updateProfileButton(window.translations, lang);
                }
            }
        });
    }

    desktopButtons.forEach(btn => attach(btn, el => el.dataset.lang));
    chips.forEach(chip => attach(chip, el => el.getAttribute('data-lang')));
}

window.initLanguageSwitchers = initLanguageSwitchers;