# Git‑CMS: добавление и синхронизация товаров

Ниже — пошаговая инструкция, как работать с удалённым репозиторием (GitHub) для хранения товаров в `products.json`, и как добавлять карточки.

## 1) Подготовка репозитория
- Создайте репозиторий на GitHub (публичный или приватный).
- Добавьте (или заранее создайте) файл по пути `data/products.json` в ветке (например, `main`).
- Получите Personal Access Token (PAT) с правом доступа к содержимому репозитория (scopes: `repo` для приватного или `public_repo` для публичного).

## 2) Включение админ‑режима в приложении
- Нажмите кнопку `Admin` в правом верхнем углу, либо используйте сочетание клавиш:
  - Windows/Linux: Ctrl+Alt+A
  - macOS: ⌘+Alt+A
- Откроется форма входа (пароль по умолчанию: `admin123`). После входа появятся админ‑кнопки (Add Product, Clear Products) и ссылка «Админка».

## 3) Настройка Git‑CMS провайдера
Откройте страницу админки `#admin/products`. В блоке настроек выберите провайдер Git‑CMS и заполните поля:
- Repo: `owner/repo` (например, `YourUser/your-products-repo`)
- Branch: ветка (например, `main`)
- Path: путь к JSON (например, `data/products.json`)
- Token: ваш PAT
Нажмите «Сохранить».

Альтернатива — из консоли браузера (удобно для быстрого старта):

```js
// Настроить и сразу переключиться на Git‑CMS
window.configureGitCMS({
  repo: 'YourUser/your-products-repo',
  branch: 'main',
  path: 'data/products.json',
  token: 'ghp_XXXX...'
});
```

## 4) Сценарии работы
- Загрузить (Load): подтягивает товары из Git в локальное хранилище (LocalStorage) и перерисовывает каталог.
- Записать (Push): выгружает текущие локальные товары в Git, полностью заменяя файл (`products.json`).
- Загрузить и слить (Merge): подтягивает удалённые товары, объединяет с локальными, пытается разрешить простые конфликты по `id`/`sku`, сохраняет результат локально.

Под капотом: API GitHub `/repos/:owner/:repo/contents/:path` (чтение/запись base64) с коммитами.

## 5) Добавление товара через UI
- В админ‑режиме нажмите `Add Product` → заполните форму → `Сохранить`.
- Товар сохраняется локально (LocalStorage) и сразу появляется в каталоге.
- Готовы синхронизировать — нажмите `Записать` (Push) в Git‑CMS панели.

## 6) Импорт/Экспорт локально
- Экспорт: кнопка `Export` сохранит локальные товары в файл JSON.
- Импорт: `Import` загрузит JSON в локальные товары (только для LocalStorage провайдера).

## 7) Нормализованная схема (для products.json)
Для удалённого хранилища используется нормализованный формат (см. `js/product-schema.js`). Минимальные поля:
- `sku` — обязателен и уникален
- `categories` — массив слагов категорий (см. `js/content-config.js`)
- `name.uk` — обязателен (основной язык)
- `images[0].src` — хотя бы одна картинка
- `price >= 0`

Пример см. в `data/products.json`.

### Готовый пример файла
В репозитории добавлен пример `data/products.json` с двумя демо‑товарами. Его можно использовать как стартовую версию в Git‑репозитории, а затем заменить своими товарами через админ‑панель (Push) или напрямую через GitHub UI.

## 8) Быстрые утилиты (встроено)
- Переключить провайдера:
  - `window.switchToGitCMS()`
  - `window.switchToLocalProvider()`
- Выгрузить локальные товары в нормализованный JSON (для ручной вставки в Git при необходимости):
  - `window.dumpLocalProductsNormalized()`

## 9) Безопасность
- PAT хранится в `localStorage` — используйте токены с минимальными правами.
- Не публикуйте токен в публичных репозиториях/скриншотах.

## 10) Траблшутинг
- «Git‑CMS не настроен» — проверьте Repo/Branch/Path/Token, сохранены ли они, проверьте права PAT.
- «Не удалось загрузить товары» — убедитесь, что по указанному пути существует файл, и у токена есть права.
- Конфликты при Merge — проверьте конфликты по `id`/`sku`; вручную разрешите и снова Push.
