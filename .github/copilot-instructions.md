## Инструкции для GitHub Copilot

Документ описывает соглашения проекта для генерации кода и правок.

### 1. Архитектура
- SPA без фреймворков (чистые HTML + CSS + JS).
- Компоненты (фрагменты HTML) находятся в `components/` и подгружаются динамически.
- Темизация (светлая/тёмная) через CSS переменные в `css/main.css`.
- PWA: `service-worker.js` (кеширование), `manifest.json`.
- Мобильное меню (slide-in справа), адаптивный header с динамическим сжатием и масштабом логотипа.

### 2. Ключевые пути
- `index.html` – корневой контейнер приложения.
- `css/main.css` – глобальные стили, переменные тем, адаптив, анимации.
- `js/main.js` – инициализация UI, навигация, мобильное меню, динамические эффекты.
- `js/cart.js` – корзина (добавление, удаление, подсчёт сумм).
- `js/products.js` – каталог, фильтрация/загрузка, скелетоны.
- `js/i18n.js` – переключение языка, локализация текстов.
- `js/theme.js` – переключатель темы и синхронизация.
- `components/*.html` – модули интерфейса (header, hero, services, products, contacts, footer, cart, модалки).
- `icons/` – спрайт и одиночные SVG/PNG.
- `service-worker.js` – версия кеша + стратегии (network-first для критичных ресурсов).

### 3. Принципы разработки
1. Семантика: используем корректные теги (`nav`, `header`, `main`, `section`, `footer`).
2. Доступность: ARIA атрибуты для навигации, фокус-ловушки при открытых модальных/меню.
3. Отложенная инициализация: тяжёлые/редко используемые возможности (свайпы, анимации) подключаются при первом взаимодействии.
4. Производительность: минимизировать layout thrash (кеш значений, rAF для скролл‑обновлений, passive listeners).
5. Унификация стилей: кнопки/карточки через общие классы (`.btn`, `.card`, и т.п.).
6. Темизация: новые цвета только через существующие CSS-переменные. Если переменной нет — добавить в корневой блок и описать применение.
7. Чистота DOM: не вставлять дубликаты компонент при повторной навигации.
8. SRP в JS: каждая функция решает одну задачу (инициализация, переключение, рендер секции и т.д.).

### 4. Навигация и компоненты
- Навигация клиентская: подгрузка HTML-фрагментов и вставка в контейнер.
- Использовать единый механизм загрузки (функция из `js/main.js`).
- После вставки компонента: навесить его события (делегирование предпочтительно).
- Новая секция: файл `components/<name>.html` + вызов загрузки при навигации.

### 5. Мобильное меню
- Панель выезжает справа (transform translateX).
- Управление: кнопка бургер, внутренняя кнопка закрытия, Esc, клик по фону, свайп.
- Ленивая инициализация: жесты и stagger-анимации только при первом открытии.
- Динамическое сжатие header: scroll → обновление CSS переменных (в rAF, не напрямую из события).
- Логотип масштабируется (CSS var) с кэшированием, избегаем лишних setProperty.

### 6. Локализация (i18n)
- `js/i18n.js` содержит переключение языка и словари.
- Тексты в компонентах помечаются атрибутами или data-ключами (если внедрено).
- Добавляя новый текст, обновить словари и убедиться в fallback (например, `ru` → `en`).

### 7. Тема (светлая/тёмная)
- Логика в `js/theme.js` (если отсутствует — расширить по примеру существующего переключателя в `main.js`).
- Пользовательский выбор сохранять (localStorage / prefers-color-scheme fallback).
- SVG-иконки должны адаптироваться через `currentColor` либо темы (не жёсткие цвета внутри path, если возможно).

### 8. Корзина
- Логика изменения данных/состояний в `js/cart.js`.
- Из UI вызывать публичные функции (не дублировать логику пересчёта сумм).
- Хранение состояния — в памяти (при перезагрузке сбрасывается, если не реализовано иное).

### 9. Продукты
- Шаблоны карточек в `components/product-card.html` или встроенные сниппеты.
- Скрипт `js/products.js` отвечает за загрузку данных, рендер, обновление фильтров.
- Skeleton/placeholder показывается до загрузки.

### 10. PWA и Service Worker
- Версию кеша обязательно инкрементировать при изменениях критических ресурсов.
- Стратегия: `network-first` для HTML/CSS/JS (обновляемость), fallback на кеш оффлайн.
- Добавляя новые статические ассеты — включить их в список пред-кеша.
- Избегать слишком агрессивного кеширования динамических данных (нет собственных API — безопасно).

### 11. Производительность (Checklist)
- [x] rAF для скролл‑зависимых вычислений.
- [x] passive listeners на scroll/touch.
- [x] Кэширование вычисленных значений (высоты, scale).
- [x] Will-change только там, где реально есть анимация.
- [x] Ленивая загрузка тяжёлых функций.
- [ ] Избегать лишних принудительных reflow (добавлять при изменениях!).
- [ ] Не добавлять новые таймеры setInterval без крайней необходимости.

### 12. Добавление новой секции (пример)
1. Создать `components/<name>.html`.
2. Разметка: использовать существующие классы (типографика, кнопки, коробки).
3. Избегать inline-стилей — только классы + CSS переменные.
4. Подключить через навигационный конфиг или хэндлер (если есть конфиг-файл `navigation-config.js`).
5. После вставки — инициализация событий внутри одного init-функционального блока.

### 13. Добавление SVG-иконки
1. Открыть `icons/icons-sprite.svg` (или основной спрайт).
2. Добавить `<symbol id="icon-new" viewBox="0 0 ...">...</symbol>`.
3. Использовать в HTML: `<svg class="icon"><use href="icons/icons-sprite.svg#icon-new"></use></svg>`.
4. Цвет: через `fill="currentColor"` или оставить без fill для наследования.

### 14. Адаптивность
- Медиа-точки: ориентироваться на уже существующие (просмотреть `css/main.css`).
- Не хардкодить px там, где подходит относительная единица (em/rem/%/clamp()).
- Проверить мобильное меню после изменений (не ломать transform/transition).

### 15. Доступность
- Меню: при открытии — фокус внутри (trap), при закрытии — возврат на кнопку бургера.
- Esc закрывает активный overlay.
- Контраст текста: соответствовать минимум WCAG AA (проверить цвета темы при добавлении новых).

### 16. Стиль кода JS
- Имена функций глагольные: `initX`, `loadY`, `toggleZ`.
- Не плодить глобальные переменные — использовать замыкания или неймспейсы.
- Комментарии только там, где логика неочевидна (не дублировать то, что ясно из названия).

### 17. Ошибки и логгирование
- В проде не оставлять console.log кроме критичных (ошибки SW, загрузки ключевых модулей). Можно временно помечать `// DEBUG:` для быстрого поиска и удаления.

### 18. Когда обновлять этот файл
- Добавили новую сущность (контроллер, крупный модуль) — короткий раздел.
- Изменили стратегию кеширования SW — обновить раздел 10.
- Ввели новый паттерн (например, контроллер меню) — описать API.

### 19. Отложенные улучшения
- MobileNavController (объединение логики меню) — см. обсуждение, пока отложено.
- Edge-swipe open (правый край) — потенциально.
- Drag-to-close с инерцией — опционально.
- Разделение кешей SW (static/runtime) — при росте ассетов.

### 20. Мини чеклист перед коммитом
1. Нет ли дубликатов классов / стилей?  
2. Все новые цвета через переменные?  
3. Не добавлен ли глобальный слушатель без снятия?  
4. SW версия увеличена (если менялись кешируемые файлы)?  
5. Локализации обновлены?  
6. Тест мобильного меню (открыть → закрыть → Esc → свайп).  
7. Lighthouse (Performance / Accessibility не деградировал заметно).  

---
Последнее обновление: (обновите дату при правке) 2025-10-06
